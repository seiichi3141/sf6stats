# 要件定義書

## 背景と目的

- ストリートファイター6のキャラクター使用率・勝率・対戦ダイヤグラムを可視化し、プレイヤー/コミュニティがメタを把握できるサイトを提供する。
- 公式 API (月次) から統計を取得し、全体とマスター帯の差異を示す。

## データソース

- 使用率 (全体): <https://www.streetfighter.com/6/buckler/api/ja-jp/stats/usagerate/202509>
- 対戦ダイヤ (全体): <https://www.streetfighter.com/6/buckler/api/ja-jp/stats/dia/202509>
- 使用率 (マスター): <https://www.streetfighter.com/6/buckler/api/ja-jp/stats/usagerate_master/202509>
- 対戦ダイヤ (マスター): <https://www.streetfighter.com/6/buckler/api/ja-jp/stats/dia_master/202509>
- 想定フォーマット: JSON。期間指定は URL の年月パス (例: `202509`) で切替。

## 対象ユーザー

- ランク帯別のメタを把握したいプレイヤー。
- 対戦会/大会運営者（バランス把握）。
- コーチ/コンテンツ制作者（解説資料作成）。

## 機能要件

1) キャラクターメタ概要
   - 使用率トップ/ボトムのランキング表示（全体・マスター切替）。
   - 勝率 (ダイヤから算出可能なら) と使用率を併記し、相関の有無を示す。
   - 期間セレクタ (年月) でデータを切替。
2) 対戦ダイヤグラム
   - キャラ×キャラの相性表をヒートマップ表示（全体・マスター切替）。
   - 特定キャラを軸に有利/不利マッチアップを上位 N 件リスト表示。
   - ダイヤ値の凡例としきい値（有利/五分/不利）を明示。
3) キャラ詳細ビュー
   - 使用率推移 (期間を跨いで取得できる場合)。
   - マッチアップ一覧とフィルタ（有利のみ、不利のみ）。
4) エクスポート/共有
   - 表やリストの CSV/画像エクスポート。
   - 共有用の URL パラメータ（期間、キャラ、モード）。
5) 更新情報
   - データ最終更新日時と取得元 URL を表示。

## 非機能要件

- パフォーマンス: 初回ロード < 2s (キャッシュ利用、SSR/ISR を検討)。
- 可用性: API 失敗時はリトライとフォールバック (直近キャッシュ) を表示。
- 表示対応: PC/モバイル両対応、ヒートマップは横スクロールまたは縮小ビューを用意。
- アクセシビリティ: 色分けに加え数値/ラベルを併記。

## データ取得・更新

- 月次で API パスが変わるため、最新年月を自動判定する仕組みを用意（例: 当月をデフォルト、過去月は選択式）。
- 取得した JSON をサーバー側でキャッシュし、一定期間で再取得 (例: 6時間)。
- キャッシュ失敗時は前回成功分を提示し、エラーメッセージを表示。

## 技術的方針

- Next.js App Router。サーバーコンポーネントでデータ取得し、クライアントは表示・インタラクションのみ。
- 型定義を用意し、API スキーマを明示 (UsageRate, DiaMatrix など)。
- Tailwind 4 でレイアウト・ヒートマップのカラースケールを定義。

## 今後の拡張余地

- シーズン/パッチごとの差分表示。
- 大会リザルトや CFN のユーザーデータと組み合わせた分析。
- コメント/フィードバック投稿機能。
